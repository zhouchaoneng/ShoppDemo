<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<!--edge浏览器H5兼容设置-->
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!--360浏览器H5兼容设置-->
<meta name="renderer" content="webkit" />
<title>学子商城</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!--导入核心文件-->
<script src="../bootstrap3/js/holder.js"></script>
<link href="../bootstrap3/css/bootstrap.css" rel="stylesheet"
	type="text/css">
<script src="../bootstrap3/jquery-1.9.1.min.js"></script>
<script src="../bootstrap3/js/bootstrap.js"></script>
<!-- 字体图标 -->
<link rel="stylesheet"
	href="../bootstrap3/font-awesome-4.7.0/css/font-awesome.css" />
<link rel="stylesheet" type="text/css" href="../css/layout.css" />
<link rel="stylesheet" type="text/css" href="../css/top.css" />
<link rel="stylesheet" type="text/css" href="../css/footer.css" />
<link rel="stylesheet" type="text/css" href="../css/cart.css" />
<script src="../js/cart.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>
	<!--头部-->
	<header class="header">
		<!--学子商城logo-->
		<div class="row">
			<div class="col-md-3">
				<a href="index.html"> <img src="../images/index/stumalllogo.png" />
				</a>
			</div>
			<!--快捷选项-->
			<div class="col-md-9 top-item">
				<ul class="list-inline pull-right">
					<li><a href="favorites.html"><span class="fa fa-heart"></span>&nbsp;收藏</a></li>
					<li class="li-split">|</li>
					<li><a href="orders.html"><span class="fa fa-file-text"></span>&nbsp;订单</a></li>
					<li class="li-split">|</li>
					<li><a href="cart.html"><span class="fa fa-cart-plus"></span>&nbsp;购物车</a></li>
					<li class="li-split">|</li>
					<li>
						<!--下列列表按钮 ：管理-->
						<div class="btn-group">
							<button type="button" class="btn btn-link dropdown-toggle"
								data-toggle="dropdown">
								<span id="top-dropdown-btn"><span class="fa fa-gears"></span>&nbsp;管理
									<span class="caret"></span></span>
							</button>
							<ul class="dropdown-menu top-dropdown-ul" role="menu">
								<li><a href="password.html">修改密码</a></li>
								<li><a href="userdata.html">个人资料</a></li>
								<li><a href="upload.html">上传头像</a></li>
								<li><a href="address.html">收货管理 </a></li>
							</ul>
						</div>
					</li>
					<li class="li-split">|</li>
					<li><a href="login.html"><span class="fa fa-user"></span>&nbsp;<span
							id="aspan">"未登录"</span></a></li>
				</ul>
			</div>
		</div>
	</header>
	<!--导航 -->
	<!--分割导航和顶部-->
	<div class="row top-nav">
		<div class="col-md-6">
			<ul class="nav nav-pills">
				<li><a href="#"></a></li>
				<li class="active"><a href="index.html"><span
						class="fa fa-home"></span></a></li>
				<li><a href="#">秒杀</a></li>
				<li><a href="#">优惠券</a></li>
				<li><a href="#">学子VIP</a></li>
				<li><a href="#">外卖</a></li>
				<li><a href="#">超市</a></li>
			</ul>
		</div>

	</div>
	<!--头部结束-->
	<!--导航结束-->
	<div class="container">
		<div class="col-md-offset-1 col-md-10">
			<div class="panel panel-primary">
				<div class="panel-heading">
					<p class="panel-title">
						<span class="fa fa-shopping-cart"></span> 购物车
					</p>
				</div>
				<div class="panel-body">
					<form role="form">
						<!--购物车表格开始-->
						<table class="cart-table" width="100%">
							<thead>
								<tr>
									<th width="8%"><input id="seekss" type="checkbox"
										class="ckall" onclick="checkall(this)" />全选</th>
									<th width="110"></th>
									<th width="29%">商品</th>
									<th width="11%">单价</th>
									<th width="15%">数量</th>
									<th width="11%">金额</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody id="table1" class="cart-body">

							</tbody>
						</table>
						<div class="total-bar">
							<a id="deleteShop" class="cart-del-sel btn btn-default btn-xs">删除所选商品</a>
							<span class="pull-right">已选商品 <span id="kep1">0</span>件
								总价¥ <span id="kep2">0</span>元
							</span>
						</div>
						<div>
							<span class="pull-right"> <input id="voer" type="button"
								value="  结  算  " class="btn btn-primary btn-lg " />
							</span>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<!--页脚开始-->
	<div class="clearfix"></div>
	<footer class="footer">
		<!-- 品质保障，私人定制等-->
		<div class="text-center rights container">
			<div class="col-md-offset-2 col-md-2">
				<span class="fa fa-thumbs-o-up"></span>
				<p>品质保障</p>
			</div>
			<div class="col-md-2">
				<span class="fa fa-address-card-o"></span>
				<p>私人订制</p>
			</div>
			<div class="col-md-2">
				<span class="fa fa-graduation-cap"></span>
				<p>学生特供</p>
			</div>
			<div class="col-md-2">
				<span class="fa fa-bitcoin"></span>
				<p>专属特权</p>
			</div>
		</div>
		<!--联系我们、下载客户端等-->
		<div class="container beforeBottom">
			<div class="col-md-offset-1 col-md-3">
				<div>
					<img src="../images/index/stumalllogo.png" alt="" class="footLogo" />
				</div>
				<div>
					<img src="../images/index/footerFont.png" alt="" />
				</div>
			</div>
			<div class="col-md-4 callus text-center">
				<div class="col-md-4">
					<ul>
						<li><a href="#">
								<p>买家帮助</p>
						</a></li>
						<li><a href="#">新手指南</a></li>
						<li><a href="#">服务保障</a></li>
						<li><a href="#">常见问题</a></li>
					</ul>
				</div>
				<div class="col-md-4">
					<ul>
						<li><a href="#">
								<p>商家帮助</p>
						</a></li>
						<li><a href="#">商家入驻</a></li>
						<li><a href="#">商家后台</a></li>
					</ul>
				</div>
				<div class="col-md-4">
					<ul>
						<li><a href="#">
								<p>关于我们</p>
						</a></li>
						<li><a href="#">关于达内</a></li>
						<li><a href="#">联系我们</a></li>
						<li><span class="fa fa-wechat"></span> <span
							class="fa fa-weibo"></span></li>
					</ul>
				</div>
			</div>
			<div class="col-md-4">
				<div class="col-md-5">
					<p>学子商城客户端</p>
					<img src="../images/index/ios.png" class="lf"> <img
						src="../images/index/android.png" alt="" class="lf" />
				</div>
				<div class="col-md-6">
					<img src="../images/index/erweima.png">
				</div>
			</div>
		</div>
		<!-- 页面底部-备案号 #footer -->
		<div class="col-md-12 text-center bottom">
			Copyright © 2018 Tedu.cn All Rights Reserved 京ICP备08000853号-56 <a
				target="_blank" style="font-size: 12px" href="http://www.tedu.cn/">达内时代科技集团有限公司</a>
			版权所有
		</div>
	</footer>
	<!--页脚结束-->
	<script type="text/javascript">
		$(function() {
			//返回链接
			$(".link-account").click(function() {
				location.href = "orderConfirm.html";
			})
		})
	</script>
</body>
<script type="text/javascript">
	//页面加载后处理
	$(document)
			.ready(
					function() {
						showUserMessage();
						showShopMessage();
						//通过选择器选中提交按钮，添加点击事件
						var shopLength = 0;
						//购物车商品
						
						//结算页面
						$("#voer").click(function(){
							var arr =new Array(0);
							//勾选了的商品的id值
							var length = 0;
							length = Number(length);
							for(var i=1;i<=shopLength;i++){
								var boo = $("#goodsCheck"+i+"").prop('checked');
								//判断是否选中
								if(boo){
								var id =	$("#goodsCheck"+i+"").attr("name");
									//如果勾选了就获取id值
								var num = $("#goodsCount" + i + "").val();
									//勾选的商品的数量
								id = Number(id);
								arr[length] = id;
								length = length+1;
								arr[length] = num;
								length = length+1;
								}
							}
							var sel = isNaN(arr[0]);
							if(sel==false){
							window.location ="orderConfirm.html?arr="+arr;
							}else{
								alert("请选择商品");
							}
						});
						
						
						//批量删除内容
						$("#deleteShop").click(function(){
							var arr = new Array(8);
							//勾选了的商品
							var length = 0;
							length = Number(length);
							for(var i=1;i<=shopLength;i++){
								var boo = $("#goodsCheck"+i+"").prop('checked');
								//判断是否选中
								if(boo){
								var id =	$("#goodsCheck"+i+"").attr("name");
									//如果勾选了就获取id值
									id = Number(id);
								arr[length] = id;
								length = length+1;
								}
							}
						//使用ajax()发起请求,获取响应结果,并处理响应
						//该函数的参数是一个json对象
							$.ajax({
								"url":"/SpringBoot/Gshop/arrShop.do",		
								"data":{arr:arr},
								"type":"post",
								"traditional":true,
								"dataType":"json",
								"success":function(json){	
										if(json.staet==0){
											window.location = "cart.html";
											alert("删除成功!");
										}else{
											alert(json.message);	
										}	
								}
							});	
						});
						
						
						//删除购物车商品
						$("#table1").on(
								'click',
								'b',
								function() {	
									var id = $(this).attr("value");
									var i = $(this).attr("name");
								
									$.ajax({
										"url":"/SpringBoot/Gshop/deleteShop.do",		
										"data":"gid="+id,
										"type":"post",
										"dataType":"json",
										"success":function(json){	
												if(json.staet==0){
													$("#tr"+i+"").empty();
													alert("删除成功!");
												}else{
													alert(json.message);	
												}	
										}
									});		
								});
						
						
						
						//设置勾选效果显示
						$("#table1").on(
								'click',
								'input',
								function() {	
									var val = $(this).attr("value");
									var name = $(this).attr("name");
									var sel = isNaN(name);
									if(sel==false){
										var boo = $(this).prop('checked');
										//判断是否勾选
										var num = $(
													"#goodsCount" + val + "")
													.val();
										if(num<1){
											alert("数量小于1无法勾选");
											$(this).attr("checked",false);
										}
									
										if (boo) {
											//勾选
											var num = $(
													"#goodsCount" + val + "")
													.val();
											//数量
											var price = $(
													"#goodsCast" + val + "")
													.attr("value");
											//单价
											if (num != 0) {
												var amount = price * num;
												var k1 = $("#kep1").text();
												var k2 = $("#kep2").text();
												k1 = Number(k1);
												k2 = Number(k2);
												num = Number(num);
												amount = Number(amount);
												$("#kep1").text(k1 + num);
												//修改数量
												$("#kep2").text(k2 + amount);
												//修改总金额
												$("#goods"+val+"").attr("onclick",100);	
												$("#good"+val+"").attr("onclick",100);	
											}
										} else {
											var num = $(
													"#goodsCount" + val + "")
													.val();
											//数量
											var price = $(
													"#goodsCast" + val + "")
													.attr("value");
											//单价	
											var amount = price * num;
											var k1 = $("#kep1").text();
											var k2 = $("#kep2").text();
											k1 = Number(k1);
											k2 = Number(k2);
											$("#kep1").text(k1 - num);
											//修改数量
											$("#kep2").text(k2 - amount);
											//修改总金额
											$("#goodsCount" + val + "").val("1");	
											$("#goodsCast" + val + "").empty();
											$("#good"+val+"").attr("onclick","reduceNum("+val+")");	
											$("#goods"+val+"").attr("onclick","addNum("+val+")");	
										}
									}
								});

						//设置全选效果
						$("#seekss").click(
								function() {
									var boo = $("#seekss").prop('checked');
									//当boo为true时
									var nums = 0;
									nums = Number(nums);
									var amount = 0;
									amount = Number(amount);
									//总金额
									var count = 0;
									if (boo) {
										for (var i = 1; i <= shopLength; i++) {
										var ord = $(
													"#goodsCount" + i + "")
													.val();
										if(ord<1){
											count = 1;
											$("#goodsCheck"+i+"").attr("checked",false);
										}
											var num = $("#goodsCount" + i + "")
													.val();
											num = Number(num);
											nums = nums + num;
											if (num != 0) {
												//获得数量
												var price = $(
														"#goodsCast" + i + "")
														.attr("value");
												price = Number(price);
												//不等于零就单价乘数量
												var c = (price * num);
												amount = amount + c;
											}
											$("#goods"+i+"").attr("onclick",100);	
											$("#good"+i+"").attr("onclick",100);	
										}
										$("#kep1").text(nums);
										$("#kep2").text(amount);
									if(count>0){
										alert("数量小1的无法勾选");
									}
									} else {
										$("#kep1").text(0);
										$("#kep2").text(0);
										for (var i = 1; i <= shopLength; i++) {
											$("#goodsCount" + i + "").val("1");	
											$("#goodsCast" + i + "").empty();
											$("#good"+i+"").attr("onclick","reduceNum("+i+")");	
											$("#goods"+i+"").attr("onclick","addNum("+i+")");	
										}
										
									}
								});

						function showShopMessage() {
							$
									.ajax({
										"url" : "/SpringBoot/Gshop/showGShop.do",
										"type" : "get",
										"dataType" : "json",
										"success" : function(json) {
											for (var i = 0; i < json.date.length; i++) {
												var tr = '<tr id="tr'+(i+1)+'"><td>'
														+ '<input value="'
														+ (i + 1)
														+ '"'
														+ ' type="checkbox" name="'+json.date[i].id+'" id="goodsCheck'
														+ (i + 1)
														+ '" class="ckitem" /></td>'
														+ '<td><img width="100px" height="100px" src="'+json.date[i].image+'" /></td>'
														+ '<td>'
														+ json.date[i].title
														+ '</td>'
														+ '<td>¥<span id="goodsPrice'
														+ (i + 1)
														+ '">'
														+ json.date[i].price
														+ '</span></td><td>'
														+ '<input type="button" id="good'+(i+1)+'" value="-" class="num-btn" onclick="reduceNum('
														+ (i + 1)
														+ ')" />'
														+ '<input id="goodsCount'
														+ (i + 1)
														+ '" type="text" size="2" readonly="true" class="num-text" value="1">'
														+ '<input class="num-btn" id="goods'+(i+1)+'"  type="button" value="+"   onclick="addNum('
														+ (i + 1)
														+ ')" />'
														+ '</td>'
														+ '<td><span id="goodsCast'
														+ (i + 1)
														+ '" value="'
														+ (json.date[i].price)
														+ '"></span></td>'
														+ '<td>'
														+ '<b name="'+(i+1)+'" value="'+json.date[i].id+'"'
														+ '"> <input  type="button" class="cart-del btn btn-default btn-xs" value="删除" /> </b>'
														+ '</td></tr>'
												$("#table1").append(tr);
											}
											shopLength = json.date.length;
										}
									});
						}

						function showUserMessage() {
							$.ajax({
								"url" : "/SpringBoot/users/userMessage.do",
								"type" : "get",
								"dataType" : "json",
								"success" : function(json) {
									$("#aspan").text(json.date.username);
								}
							});
						}
					});
</script>
</html>